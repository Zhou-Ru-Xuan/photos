<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1146" height="738" viewBox="-0.5 -0.5 1141 733" content="&lt;mxfile host=&quot;km.sankuai.com&quot; modified=&quot;2021-03-01T12:05:50.378Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.192 Safari/537.36&quot; etag=&quot;ZbXgUwxDsi7TjAshsXco&quot; version=&quot;13.6.2&quot;&gt;&lt;diagram id=&quot;C5RBs43oDa-KdzZeNtuy&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-277-304-232-64-0"><rect x="277" y="304" width="232" height="64"/></clipPath><clipPath id="mx-clip-277-376-232-62-0"><rect x="277" y="376" width="232" height="62"/></clipPath><clipPath id="mx-clip-437-544-272-26-0"><rect x="437" y="544" width="272" height="26"/></clipPath><clipPath id="mx-clip-437-578-272-40-0"><rect x="437" y="578" width="272" height="40"/></clipPath><clipPath id="mx-clip-77-544-272-44-0"><rect x="77" y="544" width="272" height="44"/></clipPath><clipPath id="mx-clip-77-596-272-50-0"><rect x="77" y="596" width="272" height="50"/></clipPath><clipPath id="mx-clip-262-42-262-156-0"><rect x="262" y="42" width="262" height="156"/></clipPath></defs><g><path d="M 393 273 L 393 210.18" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 393 193.18 L 401.5 210.18 L 384.5 210.18 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 233px; margin-left: 393px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Extends</div></div></div></foreignObject><text x="393" y="236" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Extends</text></switch></g><path d="M 213 513 L 318.85 442.99" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 333.03 433.62 L 323.54 450.08 L 314.16 435.9 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 473px; margin-left: 274px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Extends</div></div></div></foreignObject><text x="274" y="476" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Extends</text></switch></g><path d="M 573 513 L 468.08 443.05" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 453.93 433.62 L 472.79 435.98 L 463.36 450.12 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 473px; margin-left: 513px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Extends</div></div></div></foreignObject><text x="513" y="476" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Extends</text></switch></g><rect x="543" y="58" width="190" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 188px; height: 1px; padding-top: 98px; margin-left: 545px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">抽象类，定义了GuavaRateLimiter的工厂方法，执行方法，以及配置修改方法</div></div></div></foreignObject><text x="545" y="102" fill="#000000" font-family="Helvetica" font-size="12px">抽象类，定义了GuavaRateLimiter的工厂方法，执行方法，以及配置修改方法</text></switch></g><path d="M 273 299 L 273 273 L 513 273 L 513 299" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 273 299 L 273 433 L 513 433 L 513 299" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 273 299 L 513 299" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" font-style="italic" pointer-events="none" text-anchor="middle" font-size="12px"><text x="392.5" y="290.5">SmoothRateLimiter</text></g><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-277-304-232-64-0)" font-size="12px"><text x="278.5" y="316.5">  storedPermits: double</text><text x="278.5" y="330.5">  maxPermits: double</text><text x="278.5" y="344.5">  stableIntervalMicros: double</text><text x="278.5" y="358.5">- nextFreeTicketMicros: long </text></g><path d="M 273 367 L 513 367" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-277-376-232-62-0)" font-size="12px"><text x="278.5" y="388.5">  queryEarliestAvailable(long): long</text><text x="278.5" y="402.5">  reserveEarliestAvailable(int, long): long</text><text x="278.5" y="416.5">- resync(long): void</text></g><path d="M 433 539 L 433 513 L 713 513 L 713 539" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 433 539 L 433 613 L 713 613 L 713 539" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 433 539 L 713 539" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="572.5" y="530.5">SmoothBursty</text></g><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-437-544-272-26-0)" font-size="12px"><text x="438.5" y="556.5">  maxBurstSeconds: double</text></g><path d="M 433 569 L 713 569" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-437-578-272-40-0)" font-size="12px"><text x="438.5" y="590.5">  doSetRate(double): void</text><text x="438.5" y="604.5">  storedPermitsToWaitTime(double, double): long</text></g><path d="M 73 539 L 73 513 L 353 513 L 353 539" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 73 539 L 73 641 L 353 641 L 353 539" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 73 539 L 353 539" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="212.5" y="530.5">SmoothWarmingUp</text></g><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-77-544-272-44-0)" font-size="12px"><text x="78.5" y="556.5">- slope: double</text><text x="78.5" y="570.5">- halfPermits: double</text></g><path d="M 73 587 L 353 587" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-77-596-272-50-0)" font-size="12px"><text x="78.5" y="608.5">  doSetRate(double): void</text><text x="78.5" y="622.5">  storedPermitsToWaitTime(double, double): long</text></g><path d="M 258 29 L 258 3 L 528 3 L 528 29" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 258 29 L 258 193 L 528 193 L 528 29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 258 29 L 528 29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" font-style="italic" pointer-events="none" text-anchor="middle" font-size="12px"><text x="392.5" y="20.5">GuavaRateLimiter</text></g><path d="M 258 33 L 528 33" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-262-42-262-156-0)" font-size="12px"><text x="263.5" y="54.5">+ create(double): GuavaRateLimiter</text><text x="263.5" y="68.5">+ create(double, double): GuavaRateLimiter</text><text x="263.5" y="82.5">+ create(int, long, TimeUnit): GuavaRateLimiter</text><text x="263.5" y="96.5">+ acquire(): double</text><text x="263.5" y="110.5">+ acquire(int): double</text><text x="263.5" y="124.5">+ tryAcquire(int): boolean</text><text x="263.5" y="138.5">+ tryAcquire(long, TimeUnit): boolean</text><text x="263.5" y="152.5">+ tryAcquire(int, long, TimeUnit): boolean</text><text x="263.5" y="166.5">+ setRate(double): void</text><text x="263.5" y="180.5">+ getRate(): double</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 613px; height: 1px; padding-top: 358px; margin-left: 530px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">抽象类，实现了令牌桶算法<br /><ul><li>storedPermits： 令牌桶中的剩余令牌数量</li><li>maxPermits：令牌桶的容量，突发模式和预热模式中根据各自的参数分别有不同的计算方式</li><li>stableIntervalMicros：令牌产生的间隔时间，例如10QPS的产生间隔时间是100ms</li><li>nextFreeTicketMicros：下次能够获取令牌的时间点</li></ul></div></div></div></foreignObject><text x="530" y="362" fill="#000000" font-family="Helvetica" font-size="12px">抽象类，实现了令牌桶算法&#xa;storedPermits： 令牌桶中的剩余令牌数量maxPermits：令牌桶的容量，突发模式和预热模式中根据各自的参数分别有不同的计算方式stableIntervalMicros：令牌产生的间隔时间，例如10QPS的产生间隔时间是100msnextFreeTicketMicros：下次能够获取令牌的时间点</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 271px; height: 1px; padding-top: 658px; margin-left: 449px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">针对突发流量场景，管理令牌桶中的空闲令牌<br /><ul><li>maxBurstSeconds: 突发请求的时间</li></ul></div></div></div></foreignObject><text x="449" y="662" fill="#000000" font-family="Helvetica" font-size="12px">针对突发流量场景，管理令牌桶中的空闲令牌&#xa;maxBurstSeconds: 突发请求的时间</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 418px; height: 1px; padding-top: 694px; margin-left: 5px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">预热模式，限流器在冷状态下接收到请求后阈值会从低到高逐渐增大<br /><ul><li>halfPermits： maxPermits的一半，在预热模型中作为预热完成的界限</li><li>slope：预热模型中梯形的斜率，与预热时间的长短有关</li></ul></div></div></div></foreignObject><text x="5" y="698" fill="#000000" font-family="Helvetica" font-size="12px">预热模式，限流器在冷状态下接收到请求后阈值会从低到高逐渐增大&#xa;halfPermits： maxPermits的一半，在预热模型中作为预热完成的界限slope：预热模型中梯形的斜率，与预热时间的长短有关</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>